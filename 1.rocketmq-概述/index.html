<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>RocketMQ 概述 - 三此君的博客</title><meta name=description content="程序员自我救赎之路：编程知识、职场经验、程序人生、个人管理……"><meta property="og:title" content="RocketMQ 概述"><meta property="og:description" content="前 言 大家好，我是三此君，一个在自我救赎之路上的非典型程序员。 “一张图”系列旨在通过“一张图”系统性的解析一个板块的知识点： 三此君向来不喜欢零"><meta property="og:type" content="article"><meta property="og:url" content="https://sancijun.github.io/1.rocketmq-%E6%A6%82%E8%BF%B0/"><meta property="og:image" content="https://sancijun.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-03T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-03T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sancijun.github.io/logo.png"><meta name=twitter:title content="RocketMQ 概述"><meta name=twitter:description content="前 言 大家好，我是三此君，一个在自我救赎之路上的非典型程序员。 “一张图”系列旨在通过“一张图”系统性的解析一个板块的知识点： 三此君向来不喜欢零"><meta name=application-name content="三此君"><meta name=apple-mobile-web-app-title content="三此君"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://sancijun.github.io/1.rocketmq-%E6%A6%82%E8%BF%B0/><link rel=prev href=https://sancijun.github.io/2.rocketmq-%E7%94%9F%E4%BA%A7%E8%80%85/><link rel=stylesheet href=/css/page.min.css><link rel=stylesheet href=/css/home.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"RocketMQ 概述","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/sancijun.github.io\/1.rocketmq-%E6%A6%82%E8%BF%B0\/"},"image":["https:\/\/cdn.jsdelivr.net\/gh\/sancijun\/images\/pics\/avatar.webp"],"genre":"posts","keywords":"RocketMQ 架构, RocketMQ, MQ, 消息队列, 消息中间件, kafka, 元数据\u0022, NameServer, 生产者, 消费者, Broker","wordcount":5281,"url":"https:\/\/sancijun.github.io\/1.rocketmq-%E6%A6%82%E8%BF%B0\/","datePublished":"2022-05-03T00:00:00+00:00","dateModified":"2022-05-03T00:00:00+00:00","license":"TODO: This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"三此君","logo":"https:\/\/cdn.jsdelivr.net\/gh\/sancijun\/images\/pics\/avatar.webp"},"author":{"@type":"Person","name":"三此君"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=三此君的博客><span class=header-title-pre><i class="fa fa-home"></i></span>三此君</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/categories/documentation/>文档 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/sancijun title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=# class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a class=menu-item href=/index.xml title=RSS><i class="fas fa-rss fa-fw" title=RSS></i> </a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=三此君的博客><span class=header-title-pre><i class="fa fa-home"></i></span>三此君</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=# class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=# class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/categories/documentation/ title>文档</a><a class=menu-item href=/about/ title>关于</a><a class=menu-item href=https://github.com/sancijun title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><div class=menu-item><a href=/index.xml title=RSS><i class="fas fa-rss fa-fw" title=RSS></i></a>
<span>&nbsp;|&nbsp;</span><a href=javascript:void(0); class=theme-switch title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single" data-toc=enable><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/1651996418678rocketmq-banner.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/1651996418678rocketmq-banner.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/1651996418678rocketmq-banner.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/1651996418678rocketmq-banner.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/1651996418678rocketmq-banner.png title=https://cdn.jsdelivr.net/gh/sancijun/images/pics/1651996418678rocketmq-banner.png></div><div class=single-card data-image=true><h2 class="single-title animated flipInX">RocketMQ 概述</h2><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>三此君</a></span>&nbsp;<span class=post-category>出版于 <a href=/categories/rocketmq/><i class="far fa-folder fa-fw"></i>RocketMQ</a></span></div><div class=post-meta-line><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-05-03>2022-05-03</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 5281 字</span>&nbsp;
<span><i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 11 分钟</span>&nbsp;<span id=/1.rocketmq-%E6%A6%82%E8%BF%B0/ class=leancloud_visitors data-flag-title="RocketMQ 概述">
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><hr><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#前----言>前 言</a></li><li><a href=#整体架构>整体架构</a></li><li><a href=#元数据管理>元数据管理</a></li><li><a href=#消息收发示例>消息收发示例</a><ul><li><a href=#rocketmq-部署>RocketMQ 部署</a></li><li><a href=#消息发送>消息发送</a></li><li><a href=#消息接收>消息接收</a></li></ul></li><li><a href=#参考文献>参考文献</a></li></ul></nav></div></div><div class=content id=content><h2 id=前----言>前 言</h2><p>大家好，我是三此君，一个在自我救赎之路上的非典型程序员。</p><p>“一张图”系列旨在通过“一张图”系统性的解析一个板块的知识点：</p><ul><li>三此君向来不喜欢零零散散的知识点，通过一张图将零散的知识点连接起来，能够让我们对一个板块有更深入、更系统的理解。</li><li>同时本系列尽可能的精炼，希望能够让大家花 20%的时间，快速理解这个板块下 80% 的内容。</li></ul><p>本文是“一张图”系列的第一个板块：一张图解析 RocketMQ。</p><ul><li>为了叙述的方便，绘图的时候将整个系列分为许多小的模块，讲解的时候也是按照模块循序渐进的。<a href=https://sm.ms/image/vPtlGbaqHhJ9Tcg target=_blank rel="noopener noreffer">一张图解析 RocketMQ 原图</a></li><li>一张图解析 RocketMQ 是会深入到源码层面，但是文中不会粘贴源码。三此君在看源码的时候写了很多备注，可以降低大家看源码的难度，需要的同学自行到三此君的仓库中 Fork：<a href=https://github.com/sancijun/rocketmq/tree/release-4.3.0 target=_blank rel="noopener noreffer">rocketmq release-4.3.0</a></li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508151240.jpeg data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508151240.jpeg, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508151240.jpeg 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508151240.jpeg 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508151240.jpeg title="一张图进阶 RocketMQ"></p><p>本文是《一张图解析 RocketMQ》系列的第 1 篇，今天的内容主要分为三个部分：</p><ul><li>整体架构：会从大家熟悉的“生产者-消费者模式”逐步推出 RocketMQ 完整架构，只需要记住一张完整的架构图即可。</li><li>元数据管理：我把 RocketMQ 集群的元数据整理成一张图，方便大家直观的了解都有哪些元数据，各有什么用。</li><li>消息收发示例：通过 Docker 部署 RocketMQ，并用简单的示例串起 RocketMQ 消息收发流程。</li></ul><h2 id=整体架构>整体架构</h2><p>什么是消息队列？顾名思义，首先得有一个队列，这个队列用来存储消息。那有了消息队列就得有人往里面放，有人往里面取。有没有似曾相识燕归来的感 jio，这莫非就是连小学生都知道的，经典的“生产者-消费者模式”？接下来我们就来看看它里面穿了什么？</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgsimgs20220502155020.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgsimgs20220502155020.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgsimgs20220502155020.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgsimgs20220502155020.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgsimgs20220502155020.png title=img></p><p>别急，先来回顾一下 “生产者-消费者模式” 这个老朋友。简单来说，这个模型是由两类线程和一个队列构成：</p><ul><li>生产者线程：生产产品，并把产品放到队列里。</li><li>消费者线程：从队列里面获取产品，并消费。</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131657.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131657.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131657.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131657.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131657.png title=生产者-消费者></p><p>有了这个队列，生产者就只需要关注生产，而不用管消费者的消费行为，更不用等待消费者线程执行完；消费者也只管消费，不用管生产者是怎么生产的，更不用等着生产者生产。</p><p>这意味着什么呢，生产者和消费者之间实现<strong>解藕</strong>和<strong>异步</strong>。这就厉害了，因为我们生活中很多都是异步的。比如最近新冠疫情卷土重来，我点的外卖只能送到小区门口的外卖队列里面，而我只能去外卖队列里面取外卖，然后一顿狼吞虎咽。</p><p>具体 “生产者-消费者模式” 怎么实现，想必各位小学都学过了，我们来看看这个模式还有什么问题吧。最大的问题就是我们小学学的 “生产者-消费者模式” 是个单机版的，只能自嗨。这就相当于，我就是外卖骑手，我点了个外卖放到外卖队列，然后我再从外卖队列里面去取，一顿操作猛如虎呀！于是就有了进化版，我们把消费者，队列，生产者放到不同的服务器上，这就是传说中的分布式消息队列了。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131802.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131802.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131802.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131802.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131802.png title=image></p><p>生产者生产的消息通过网络传递给队列存储，消费者通过网络从队列获取消息。但是还有问题，消息可能有很多种，全都放在一起岂不是乱套了？我点的外卖和快递全都放在一起，太难找了吧。于是我们就需要区分不同类型消息，<strong>相同类型的消息称为一个 Topic</strong>。同时，骑手不可能只有一个，点外卖的也不会只有我一个人，于是就有了<strong>生产者组</strong>和<strong>消费者组</strong>。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131853.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131853.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131853.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131853.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131853.png title=image></p><p>但还是有问题呀，小区那么大，一个队列放不下。我住在小区南门，点个外卖还要跑去北门拿，那真的是 <code>eggs hurt</code>。于是物业在东南西北门各设了一个外卖快递放置点。也就是我们有多个队列，组成 <strong>队列集群</strong>。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131934.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131934.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131934.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131934.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508131934.png title=image></p><p>可是，问题又双叒叕来了（还有完没完），一个小区那么多个外卖快递队列，骑手怎么知道送到哪里去，我又怎么知道去哪里取？很简单，导航呀。我们把导航的信息称为<strong>路由信息</strong>，这些信息需要有一个管理的地方，它告诉生产者，某这个 Topic 的消息可以发给哪些队列，同时告诉消费者你需要的消息可以从哪些队列里面取。<strong>RocketMQ 为这些路由信息的设置了管理员 NameServer</strong>，当然 NameServer 也可以有很多个，组成 NameServer 集群。</p><p>到这里，你就应该知道 RocketMQ 里面都穿了什么啦。包括了<strong>生产者（Producer），消费者（Consumer），NameServer 以及队列本身（Broker）</strong>。Broker 是代理的意思，负责队列的存取等操作，我们可以把 Broker 理解为队列本身。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132132.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132132.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132132.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132132.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132132.png title=RocketMQ整体架构></p><ul><li><p>NameServer：我们可以同时部署很多台 NameServer 服务器，并且这些服务器是无状态的，节点之间无任何信息同步。
NameServer 起来后监听 端口，等待 Broker、Producer、Consumer 连上来，NameServer 是集群元数据管理中心。</p></li><li><p>Broker：Broker 启动，跟所有的 NameServer 保持长连接，每 30s 发送一次发送心跳包（像心跳一样持续稳定的发送请求）。心跳包中包含当前 Broker 信息 ( IP+ 端口等）以及存储所有 Topic 信息。注册成功后，NameServer 集群中就有 Topic 跟 Broker 的映射关系。</p><blockquote><p>我们可以同时部署多个 Master 和多个 Slave，一个 Master 可以对应多个 Slave，但是一个 Slave 只能对应一个 Master。Master 与 Slave 的需要有相同的 BrokerName，不同的 BrokerId 。BrokerId 为 0 表示 Master，非 0 表示 Slave，但只有 BrokerId=1 的从服务器才会参与消息的读负载。（可以暂时忽略 Broker 的主从角色）</p></blockquote></li><li><p>Topic：收发消息前，先创建 Topic，创建 Topic 时需要指定该 Topic 要存储在哪些 Broker 上，也可以在发送消息时自动创建 Topic。</p></li><li><p>Producer：Producer 发送消息，启动时先跟 NameServer 集群中的其中一台建立长连接，并从 NameServer 中获取当前发送的 Topic 存在哪些 Broker 上，采用轮询策略从选择一个队列，然后与队列所在的 Broker 建立长连接，并向 Broker 发消息。</p></li><li><p>Consumer：Consumer 跟 Producer 类似，跟其中一台 NameServer 建立长连接，获取当前订阅 Topic 存在哪些 Broker 上，然后直接跟 Broker 建立连接通道，开始消费消息。</p><blockquote><p>我们刚刚提到骑手不止一个，取外卖快递的也不止我一个，所以会有生产者组合消费者组的概念。这里需要补充说明一下，消息分为集群消息和广播消息：</p><ul><li><p>集群消息：一个 Topic 的一条消息，一个消费者组<strong>只能有一个消费者实例消费</strong>。例如，同样是外卖 Topic，一份外卖，我们整个小区也只有一个人消费，就是集群消费。</p></li><li><p>广播消息：一个 Topic 的一条消息，一个消费者组<strong>所有消费者实例都会消费</strong>。例如，如果是因为疫情，政府发放食品，那我们小区每个人都会消费，就是广播消费。</p></li></ul></blockquote></li></ul><h2 id=元数据管理>元数据管理</h2><p>因为 Producer、Consumer 和 Broker 都需要和 NameServer 交互，负责的三此君不得不先和大家唠唠 NameServer 是何方神圣。上面有说道 NameServer 是集群的元数据管理中心，那它到底管理了哪些元数据？我们来看看 NameServer 里面又穿了什么，看完了记得关注、转发、点赞、收藏哦。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502164522.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502164522.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502164522.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502164522.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502164522.png title=img></p><p>简单来说，NameServer 是我们的整个 RocketMQ 集群的元数据管理中心，负责集群元数据的增删改查。先不管这个增删改查是怎么实现的，我们甚至可以理解就是数据库的增删改查，但是我们一定要知道这些元数据都长什么样子。才能知道 Producer、Consumer 及 Broker 是如何根据这些数据进行消息收发的。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132241.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132241.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132241.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132241.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/20220508132241.png title=集群元数据></p><p>如图所示，二主二从的 Broker 集群相关的元数据信息，包括 topicQueueTable、BrokerAddrTable、ClusterAddrTable、brokerLiveInfo、FilterServer (暂时不用关注，图中未画出)。</p><ul><li><code>HashMap&lt;String topic, List&lt;QueueData>> topicQueueTable</code>：Key 是 Topic 的名称，它存储了所有 Topic 的属性信息。Value 是个 QueueData 列表，长度等于这个 Topic 数据存储的 Master Broker 的个数，QueueData 里存储着 Broker 的名称、读写 queue 的数量、同步标识等。</li><li><code>HashMap&lt;String BrokerName, BrokerData> brokerAddrTable</code>：这个结构存储着一个 BrokerName 对应的属性信息，包括所属的 Cluster 名称，一个 Master Broker 和多个 Slave Broker 的地址信息</li><li><code>HashMap&lt;String ClusterName, Set&lt;String BrokerName>> clusterAddrTable</code>：存储的是集群中 Cluster 的信息，就是一个 Cluster 名称对应一个由 BrokerName 组成的集合。</li><li><code>HashMap&lt;String BrokerAddr, BrokerLiveInfo> brokerLiveTable</code>：Key 是 BrokerAddr 对应着一台机器，BrokerLiveTable 存储的内容是这台 Broker 机器的实时状态，包括上次更新状态的时间戳，NameServer 会定期检查这个时间戳，超时没有更新就认为这个 Broker 无效了，将其从 Broker 列表里清除。</li><li><code>HashMap&lt;String BrokerAddr, List&lt;String> FilterServer> filterServerTable</code>：Key 是 Broker 的地址，Value 是和这个 Broker 关联的多个 FilterServer 的地址。Filter Server 是过滤服务器，是 RocketMQ 的一种服务端过滤方式，一个 Broker 可以有一个或多个 Filter Server。</li></ul><p>其他角色会主动向 NameServer 上报状态，根据上报消息里的请求码做相应的处理，更新存储的对应信息。</p><ul><li>Broker 接到创建 Topic 的请求后向 NameServer 发送注册信息，NameServer 收到注册信息后首先更新 Broker 信息，然后对每个 Master 角色的 Broker，创建一个 QueueData 对象。如果是新建 Topic，就是添加 QueueData 对象；如果是修改 Topic，就是把旧的 QueueData 删除，加入新的 QueueData。</li><li>Broker 向 NameServer 发送的心跳会更新时间戳，NameServer 每 10 秒检查一次检查时间戳，检查到时间戳超过 2 分钟则认为 Broker 已失效，便会触发清理逻辑。</li><li>连接断开的事件也会触发状态更新，当 NameServer 和 Broker 的长连接断掉以后，onChannelDestroy 函数会被调用，把这个 Broker 的信息清理出去。</li><li>Producer/Consumer 启动之后会和 NameServer 建立长连接，定时从 NameServer 获取路由信息保存到本地。消息的发送与拉取都会用到上面的数据。</li></ul><p>那么多数据，相信大家看的有点晕，三此君简单总结下：NameServer 通过 brokerLiveInfo 来维护存活的 Broker。Producer 会获取上面的路由信息，发送消息的时候指定发送到哪个 Topic，根据 Topic 可以从 topicQueueTable 选择一个 Broker，根据 BrokerName 可以从 BrokerAddrTable 获取到Broker IP 地址。有了地址 Producer 就可以将消息通过网络传递给 Broker。</p><h2 id=消息收发示例>消息收发示例</h2><h3 id=rocketmq-部署>RocketMQ 部署</h3><p>刚刚我们了解 RocketMQ 整体架构，那怎么样通过 RocketMQ 收发消息呢？需要先通过 Docker 部署一套 RocketMQ：</p><p>如果你没有安装 Docker，可以根据菜鸟教程 <a href=https://www.runoob.com/docker/macos-docker-install.html target=_blank rel="noopener noreffer">MacOS Docker 安装</a>/<a href=https://www.runoob.com/docker/windows-docker-install.html target=_blank rel="noopener noreffer">Windows Docker 安装</a> 进行安装。然后，通过 docker-compose 部署 RocketMQ：</p><ul><li>克隆 <a href=https://github.com/HereNowMe/docker-middleware target=_blank rel="noopener noreffer">docker-middleware</a> 仓库，打开 RocketMQ 目录；</li><li>修改<code>broker.conf</code>中的<code>brokerIP1 </code>参数为本机 IP；</li><li>进入<code>docker-compose.yml</code>文件所在路径，执行<code>docker-compose up</code>命令即可；</li></ul><blockquote><p>注意：如果你现在不了解 Docker 不重要，只需要按照步骤部署好 RocketMQ 即可，并不会阻碍我们理解 RocketMQ 相关内容。</p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502160639.png data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502160639.png, https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502160639.png 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502160639.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/imgs20220502160639.png title="Docker 部署 RocketMQ"></p><p>部署完成后我们就可以在 Docker Dashboard 中看到 RocketMQ 相关容器，包括 Broker、NameServer 及 Console（RocketMQ 控制台），到这里我们就可以使用部署的 RocketMQ 收发消息了。</p><p>RocketMQ 已经部署好了，接下来先来看一个简单的消息收发示例，可以说是 RocketMQ 的 &ldquo;Hello World&rdquo;。</p><h3 id=消息发送>消息发送</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SyncProducer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 实例化消息生产者Producer
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DefaultMQProducer</span> <span class=n>producer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DefaultMQProducer</span><span class=o>(</span><span class=s>&#34;please_rename_unique_group_name&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 设置NameServer的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>producer</span><span class=o>.</span><span class=na>setNamesrvAddr</span><span class=o>(</span><span class=s>&#34;localhost:9876&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 启动Producer实例
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>producer</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 创建消息，并指定Topic，Tag和消息体
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Message</span> <span class=n>msg</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Message</span><span class=o>(</span><span class=s>&#34;Topic1&#34;</span><span class=o>,</span><span class=s>&#34;Tag&#34;</span><span class=o>,</span> <span class=s>&#34;Key&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                                    <span class=s>&#34;Hello world&#34;</span><span class=o>.</span><span class=na>getBytes</span><span class=o>(</span><span class=n>RemotingHelper</span><span class=o>.</span><span class=na>DEFAULT_CHARSET</span><span class=o>));</span> 
</span></span><span class=line><span class=cl>        <span class=c1>// 发送消息到一个Broker
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>SendResult</span> <span class=n>sendResult</span> <span class=o>=</span> <span class=n>producer</span><span class=o>.</span><span class=na>send</span><span class=o>(</span><span class=n>msg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      	<span class=c1>// 通过sendResult返回消息是否成功送达
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>printf</span><span class=o>(</span><span class=s>&#34;%s%n&#34;</span><span class=o>,</span> <span class=n>sendResult</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 如果不再发送消息，关闭Producer实例。
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>producer</span><span class=o>.</span><span class=na>shutdown</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>首先，实例化一个生产者 <code>producer</code>，并告诉它 NameServer 的地址，这样生产者才能从 NameServer 获取路由信息。</li><li>然后 <code>producer</code> 得做一些初始化（这是很关键的步骤），它要和 NameServer 通信，要先建立通信连接等。</li><li><code>producer</code> 已经准备好了，那得准备好要发的内容，把 &ldquo;Hello World&rdquo; 发送到 Topic1。</li><li>内容准备好，那 <code>producer</code> 就可以把消息发送出去了。<code>producer</code> 怎么知道 Broker 地址呢？他就会去 NameServer 获取路由信息，得到 Broker 的地址是 localhost:10909，然后通过网络通信将消息发送给 Broker。</li><li>生产者发送的消息通过网络传输给 Broker，Broker 需要对消息按照一定的结构进行存储。存储完成之后，把存储结果告知生产者。</li></ul><h3 id=消息接收>消息接收</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Consumer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span><span class=o>,</span> <span class=n>MQClientException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    	<span class=c1>// 实例化消费者
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DefaultMQPushConsumer</span> <span class=n>consumer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DefaultMQPushConsumer</span><span class=o>(</span><span class=s>&#34;please_rename_unique_group_name&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	<span class=c1>// 设置NameServer的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>consumer</span><span class=o>.</span><span class=na>setNamesrvAddr</span><span class=o>(</span><span class=s>&#34;localhost:9876&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	<span class=c1>// 订阅一个或者多个Topic，以及Tag来过滤需要消费的消息
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>erbconsumerijun</span><span class=o>.</span><span class=na>subscribe</span><span class=o>(</span><span class=s>&#34;sancijun&#34;</span><span class=o>,</span> <span class=s>&#34;*&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    	<span class=c1>// 注册回调实现类来处理从broker拉取回来的消息
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>consumer</span><span class=o>.</span><span class=na>registerMessageListener</span><span class=o>(</span><span class=k>new</span> <span class=n>MessageListenerConcurrently</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>            <span class=kd>public</span> <span class=n>ConsumeConcurrentlyStatus</span> <span class=nf>consumeMessage</span><span class=o>(</span>
</span></span><span class=line><span class=cl>              <span class=n>List</span><span class=o>&lt;</span><span class=n>MessageExt</span><span class=o>&gt;</span> <span class=n>msgs</span><span class=o>,</span><span class=n>ConsumeConcurrentlyContext</span> <span class=n>context</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>printf</span><span class=o>(</span><span class=s>&#34;%s Receive New Messages: %s %n&#34;</span><span class=o>,</span> <span class=n>Thread</span><span class=o>.</span><span class=na>currentThread</span><span class=o>().</span><span class=na>getName</span><span class=o>(),</span> <span class=n>msgs</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 标记该消息已经被成功消费
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>return</span> <span class=n>ConsumeConcurrentlyStatus</span><span class=o>.</span><span class=na>CONSUME_SUCCESS</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>});</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 启动消费者实例
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>consumer</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>首先，实例化一个消费者 <code>consumer</code>，告诉它 NameServer 的地址，这样消费者才能从 NameServer 获取路由信息。</li><li>然后这个消费者需要知道自己可以消费哪些 Topic 的消息，也就是每个消费者需要订阅一个或多个 Topic。</li><li>消费者也需要做一些初始化，业务本身并没有理会怎么从 Broker 拉取消息，这些都是消费者默默无闻的奉献。所以，我们需要启动消费者，消费者会从 NameServer 拉取路由信息，并不断从 Broker 拉取消息。拉取回来的消息提供给业务定义的 MessageListener。</li><li>消息拉取回来后，消费这需要怎么处理呢？每个消费者都不一样（业务本身决定），由我们业务定义的 MessageListener 处理。处理完之后，消费者也需要确认收货，就是告诉 Broker 消费成功了。</li></ul><p>以上就是本文的全部内容，本文没有堆砌太多无意义的概念，没有讲什么削峰解耦，异步通信。这些内容网上也很多，看了和没看没什么两样。最后的最后，看懂的点赞，没看懂的收藏，顺便在分享给你的小伙伴。还没有关注的朋友记得关注，入股不亏。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/sancijun/images/pics/qrcode_banner.webp data-srcset="https://cdn.jsdelivr.net/gh/sancijun/images/pics/qrcode_banner.webp, https://cdn.jsdelivr.net/gh/sancijun/images/pics/qrcode_banner.webp 1.5x, https://cdn.jsdelivr.net/gh/sancijun/images/pics/qrcode_banner.webp 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/sancijun/images/pics/qrcode_banner.webp title=banner></p><h2 id=参考文献>参考文献</h2><ul><li><p><a href=https://github.com/apache/rocketmq/tree/master/docs/cn target=_blank rel="noopener noreffer">RocketMQ 官方文档</a></p></li><li><p><a href=https://github.com/apache/rocketmq/tree/master target=_blank rel="noopener noreffer">RocketMQ 源码</a></p></li><li><p>丁威, 周继锋. RocketMQ技术内幕：RocketMQ架构设计与实现原理. 机械工业出版社, 2019-01.</p></li><li><p>李伟. RocketMQ分布式消息中间件：核心原理与最佳实践. 电子工业出版社, 2020-08.</p></li><li><p>杨开元. RocketMQ实战与原理解析. 机械工业出版社, 2018-06.</p></li></ul><p>转载请注明出处</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-tag><span><a href=/tags/rocketmq-%E6%9E%B6%E6%9E%84/>RocketMQ 架构</a>
</span><span><a href=/tags/rocketmq/>RocketMQ</a>
</span><span><a href=/tags/mq/>MQ</a>
</span><span><a href=/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/>消息队列</a>
</span><span><a href=/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/>消息中间件</a>
</span><span><a href=/tags/kafka/>kafka</a>
</span><span><a href=/tags/%E5%85%83%E6%95%B0%E6%8D%AE/>元数据"</a>
</span><span><a href=/tags/nameserver/>NameServer</a>
</span><span><a href=/tags/%E7%94%9F%E4%BA%A7%E8%80%85/>生产者</a>
</span><span><a href=/tags/%E6%B6%88%E8%B4%B9%E8%80%85/>消费者</a>
</span><span><a href=/tags/broker/>Broker</a></span></div><div class=post-info-line><div class=post-info-mod><span>更新于 2022-05-03</span></div><div class=post-info-mod><span><a class=link-to-markdown href=/1.rocketmq-%E6%A6%82%E8%BF%B0/index.md target=_blank>阅读原始文档</a>
</span><span>&nbsp;|&nbsp;
<a class=link-to-markdown href=https://github.com/sancijunposts/%e4%b8%ad%e9%97%b4%e4%bb%b6/RocketMQ/1.RocketMQ%20%e6%a6%82%e8%bf%b0.md target=_blank>Improve Article</a></span></div></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://sancijun.github.io/1.rocketmq-%E6%A6%82%E8%BF%B0/ data-title="RocketMQ 概述" data-image=https://cdn.jsdelivr.net/gh/sancijun/images/pics/1651996418678rocketmq-banner.png data-ralateuid=u/5649725064><i class="fab fa-weibo fa-fw"></i></a></span></div></div><div class=post-nav><a href=/2.rocketmq-%E7%94%9F%E4%BA%A7%E8%80%85/ class=prev rel=prev title="RocketMQ 生产者"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a></div></div></div><div id=comments class=single-card><div id=valine></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/>三此君</a></span>&nbsp;|&nbsp;<span class=license><p>本作品采用<a href=http://creativecommons.org/licenses/by-nc-nd/4.0/ style=color:#a9a9a9>《知识共享署名-非商业性使用-禁止演绎 4.0 国际》</a>许可协议进行许可</p></span></div></div><script>"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.min.js?version=1.0.1",{scope:"/"}).then(()=>{console.info("三此君的博客\u00A0Service Worker Registered")},e=>console.error("三此君的博客\u00A0Service Worker registration failed: ",e)),navigator.serviceWorker.ready.then(()=>{console.info("三此君的博客\u00A0Service Worker Ready")}))</script></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-chevron-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment-alt fa-fw"></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><link rel=stylesheet href=/lib/valine/valine.min.css><script src=https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js></script><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.0/dist/autocomplete.min.js></script><script src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script src=/lib/lunr/lunr.stemmer.support.min.js></script><script src=/lib/lunr/lunr.zh.min.js></script><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.1/sharer.min.js></script><script>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{valine:{appId:"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI",appKey:"WBmoGyJtbqUswvfLh6L8iEBr",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-cn",pageSize:10,placeholder:"你的评论 ...",recordIP:!0,serverURLs:"https://leancloud.hugoloveit.com",visitor:!0}},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script src=/js/theme.min.js></script></body></html>