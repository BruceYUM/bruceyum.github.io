# 概述
[toc]

## 计算机结构

计算机基本结构为5个部分：中央处理器（CPU）、内存、输⼊设备、输出设备、总线。

![image-20210808132831401](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20210808132831401.png)

总线是⽤于 CPU 和内存以及其他设备之间的通信，总线可分为 3 种：

- 地址总线，⽤于指定 CPU 将要操作的内存地址；
- 数据总线，⽤于读写内存的数据；
- 控制总线，⽤于发送和接收信号，⽐如中断、设备复位等信号，CPU 收到信号后⾃然进⾏响应，这时也需要控制总线；

当 CPU 要读写内存数据的时候，⼀般需要通过两个总线：

- ⾸先要通过「地址总线」来指定内存的地址；
- 再通过「数据总线」来传输数据；

代⼤多数 CPU 都使⽤来流⽔线的⽅式来执⾏指令，所谓的流⽔线就是把⼀个任务拆分成多个⼩任务，于是⼀条指令通常分为 4 个阶段，这4个阶段我们称为指令周期（**Instrution Cycle**），CPU 的⼯作就是⼀个周期接着⼀个周期，周⽽复始。

1. CPU 通过程序计数器读取对应内存地址的指令，这个部分称为 **Fetch**（取得指令）；

2. CPU 对指令进⾏解码，这个部分称为 **Decode**（指令译码）；

3. CPU 执⾏指令，这个部分称为 **Execution**（执⾏指令）；

4. CPU 将计算结果存回寄存器或者将寄存器的值存⼊内存，这个部分称为 **Store**（数据回写）；

![image-20210808140636443](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20210808140636443.png)







## 基本特征

### 1. 并发

并发是指宏观上在一段时间内能同时运行多个程序，而并行则指同一时刻能运行多个指令。

并行需要硬件支持，如多流水线、多核处理器或者分布式计算系统。

操作系统通过引入进程和线程，使得程序能够并发运行。

### 2. 共享

共享是指系统中的资源可以被多个并发进程共同使用。

有两种共享方式：互斥共享和同时共享。

互斥共享的资源称为临界资源，例如打印机等，在同一时刻只允许一个进程访问，需要用同步机制来实现互斥访问。

### 3. 虚拟

虚拟技术把一个物理实体转换为多个逻辑实体。

主要有两种虚拟技术：时（时间）分复用技术和空（空间）分复用技术。

多个进程能在同一个处理器上并发执行使用了时分复用技术，让每个进程轮流占用处理器，每次只执行一小个时间片并快速切换。

虚拟内存使用了空分复用技术，它将物理内存抽象为地址空间，每个进程都有各自的地址空间。地址空间的页被映射到物理内存，地址空间的页并不需要全部在物理内存中，当使用到一个没有在物理内存的页时，执行页面置换算法，将该页置换到内存中。

### 4. 异步

异步指进程不是一次性执行完毕，而是走走停停，以不可知的速度向前推进。

## 基本功能

### 1. 进程管理

进程控制、进程同步、进程通信、死锁处理、处理机调度等。

### 2. 内存管理

内存分配、地址映射、内存保护与共享、虚拟内存等。

### 3. 文件管理

文件存储空间的管理、目录管理、文件读写管理和保护等。

### 4. 设备管理

完成用户的 I/O 请求，方便用户使用各种设备，并提高设备的利用率。

主要包括缓冲管理、设备分配、设备处理、虛拟设备等。

## 内核

**1.内核**：计算机是由各种外部硬件设备组成的，⽐如内存、cpu、硬盘等，如果每个应⽤都要和这些硬件设备对接通信协议，那这样太累了，所以这个中间⼈就由内核来负责，让内核作为应⽤连接硬件设备的桥梁，应⽤程序只需关⼼与内核交互，不⽤关⼼硬件的细节。

**2.用户态/内核态**

内核具有很⾼的权限，可以控制 cpu、内存、硬盘等硬件，⽽应⽤程序具有的权限很⼩，因此⼤多数操作系统，把内存分成了两个区域：内核空间，这个内存空间只有内核程序可以访问；⽤户空间，这个内存空间专⻔给应⽤程序使⽤；

应⽤程序如果需要进⼊内核空间，就需要通过系统调⽤。内核程序执⾏在内核态，⽤户程序执⾏在⽤户态。当应⽤程序使⽤系统调⽤时，会产⽣⼀个中断。发⽣中断后， CPU 会中断当前在执⾏的⽤户程序，转⽽跳转到中断处理程序，也就是开始执⾏内核程序。内核处理完后，主动触发中断，把 CPU 执⾏权限交回给⽤户程序，回到⽤户态继续⼯作。

**3.系统调用**：如果一个进程在用户态需要使用内核态的功能，就进行系统调用从而陷入内核，由操作系统代为完成。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/tGPV0.png" width="600"/> </div><br>

Linux 的系统调用主要有以下这些：

|   Task   | Commands                    |
| :------: | --------------------------- |
| 进程控制 | fork(); exit(); wait();     |
| 进程通信 | pipe(); shmget(); mmap();   |
| 文件操作 | open(); read(); write();    |
| 设备操作 | ioctl(); read(); write();   |
| 信息维护 | getpid(); alarm(); sleep(); |
|   安全   | chmod(); umask(); chown();  |

**4.宏内核**

宏内核的特征是系统内核的所有模块，⽐如进程调度、内存管理、⽂件系统、设备驱动等，都运⾏在内核态。将操作系统功能作为一个紧密结合的整体放到内核。由于各模块共享信息，因此有很高的性能。Linux 内核架构就是宏内核，意味着 Linux 的内核是⼀个完整的可执⾏程序，且拥有最⾼的权限。

**5.微内核**

由于操作系统不断复杂，因此将一部分操作系统功能移出内核，从而降低内核的复杂性。移出的部分根据分层的原则划分成若干服务，相互独立。在微内核结构下，操作系统被划分成小的、定义良好的模块，只有微内核这一个模块运行在内核态，其余模块运行在用户态。

因为需要频繁地在用户态和核心态之间进行切换，所以会有一定的性能损失。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/2_14_microkernelArchitecture.jpg"/> </div><br>

**6.混合内核**

混合类型内核，它的架构有点像微内核，内核⾥⾯会有⼀个最⼩版本的内核，然后其他模块会在这个基础上搭建，然后实现的时候会跟宏内核类似，也就是把整个内核做成⼀个完整的程序，⼤部分服务都在内核中，这就像是宏内核的⽅式包裹着⼀个微内核。**Window** 的内核设计是混合型内核。



## 中断分类

**1.外中断**

由 CPU 执行指令以外的事件引起，如 I/O 完成中断，表示设备输入/输出处理已经完成，处理器能够发送下一个输入/输出请求。此外还有时钟中断、控制台中断等。

**2.异常**

由 CPU 执行指令的内部事件引起，如非法操作码、地址越界、算术溢出等。

**3.陷入**

在用户程序中使用系统调用。

**4.软中断**

